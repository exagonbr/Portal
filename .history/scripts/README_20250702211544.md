# ğŸš€ API Route Mapper

Script para mapear e testar automaticamente todas as rotas de API do projeto Portal.

## ğŸ“‹ Funcionalidades

- **Descoberta AutomÃ¡tica**: Mapeia todas as rotas de API do diretÃ³rio `src/app/api/`
- **AutenticaÃ§Ã£o**: Faz login automaticamente com as credenciais fornecidas
- **Testes Abrangentes**: Testa todos os mÃ©todos HTTP disponÃ­veis em cada rota
- **RelatÃ³rios Detalhados**: Gera relatÃ³rios em JSON e HTML
- **Suporte a Rotas DinÃ¢micas**: Detecta e testa rotas com parÃ¢metros
- **DetecÃ§Ã£o de AutenticaÃ§Ã£o**: Identifica rotas que requerem autenticaÃ§Ã£o
- **AnÃ¡lise de Performance**: Mede tempo de resposta de cada endpoint

## ğŸ› ï¸ InstalaÃ§Ã£o

### PrÃ©-requisitos

- Node.js 18+ 
- npm ou yarn

### Instalar DependÃªncias

```bash
cd scripts
npm install
```

## ğŸš€ Como Usar

### OpÃ§Ã£o 1: Script JavaScript (Node.js puro)

```bash
# Executar com configuraÃ§Ãµes padrÃ£o
node api-route-mapper.js

# Ou usando npm script
npm run test-api
```

### OpÃ§Ã£o 2: Script TypeScript (Recomendado)

```bash
# Executar com tsx
npx tsx api-route-mapper.ts

# Ou usando npm script
npm run test-api-ts
```

### OpÃ§Ã£o 3: Diferentes Ambientes

```bash
# Ambiente de desenvolvimento (localhost:3000)
npm run test-api-dev

# Ambiente de produÃ§Ã£o
npm run test-api-prod
```

## âš™ï¸ ConfiguraÃ§Ã£o

### VariÃ¡veis de Ambiente

VocÃª pode configurar o script atravÃ©s de variÃ¡veis de ambiente:

```bash
# URL base da API
export NEXT_PUBLIC_API_URL="http://localhost:3000"

# Ou para produÃ§Ã£o
export NEXT_PUBLIC_API_URL="https://portal.sabercon.edu.br"
```

### Credenciais

As credenciais estÃ£o configuradas no script:
- **Email**: `admin@sabercon.edu.br`
- **Senha**: `password123`

Para alterar, edite o arquivo `api-route-mapper.ts` ou `api-route-mapper.js`:

```javascript
const CONFIG = {
  credentials: {
    email: 'seu-email@exemplo.com',
    password: 'sua-senha'
  }
};
```

## ğŸ“Š RelatÃ³rios

O script gera dois tipos de relatÃ³rios:

### 1. RelatÃ³rio JSON
- **LocalizaÃ§Ã£o**: `reports/api-test-report-YYYY-MM-DD.json`
- **ConteÃºdo**: Dados estruturados com todos os resultados dos testes
- **Uso**: IntegraÃ§Ã£o com outras ferramentas, anÃ¡lise programÃ¡tica

### 2. RelatÃ³rio HTML
- **LocalizaÃ§Ã£o**: `reports/api-test-report-YYYY-MM-DD.html`
- **ConteÃºdo**: Interface visual interativa com grÃ¡ficos e estatÃ­sticas
- **Uso**: VisualizaÃ§Ã£o humana, apresentaÃ§Ãµes, documentaÃ§Ã£o

## ğŸ” Exemplo de SaÃ­da

```
ğŸš€ Iniciando mapeamento de rotas de API...
ğŸ“ Base URL: http://localhost:3000
ğŸ‘¤ UsuÃ¡rio: admin@sabercon.edu.br

ğŸ“‚ Descobrindo rotas...
âœ… Encontradas 127 rotas

ğŸ“‹ Primeiras rotas encontradas:
  /activity/track [POST] ğŸ”’
  /activity/viewing-status [GET, POST] ğŸ”’
  /activity/watchlist [GET, POST, DELETE] ğŸ”’
  /admin/audit [GET] ğŸ”’
  /admin/create-default-users [POST] ğŸ”’
  ... e mais 122 rotas

ğŸ” Fazendo login...
âœ… Login realizado com sucesso!
ğŸ‘¤ UsuÃ¡rio: admin@sabercon.edu.br
ğŸ­ Papel: SYSTEM_ADMIN

ğŸ§ª Testando rotas...
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[  1/127] /activity/track
      âœ… 1/1 OK (245ms avg)
[  2/127] /activity/viewing-status
      âœ… 2/2 OK (189ms avg)
[  3/127] /activity/watchlist
      âš ï¸ 2/3 OK (156ms avg)
...

ğŸ“Š RESUMO FINAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ Base URL: http://localhost:3000
ğŸ” AutenticaÃ§Ã£o: âœ… Sucesso
ğŸ“‚ Total de rotas: 127
ğŸ§ª Total de testes: 284
âœ… Sucessos: 251
âŒ Falhas: 33
ğŸ”’ Requer autenticaÃ§Ã£o: 89
ğŸ“ˆ Taxa de sucesso: 88.4%

ğŸ“„ RelatÃ³rios salvos:
  JSON: reports/api-test-report-2025-01-07.json
  HTML: reports/api-test-report-2025-01-07.html

ğŸ“Š DistribuiÃ§Ã£o por Status HTTP:
  200: 198 (OK)
  201: 23 (Created)
  400: 15 (Bad Request)
  401: 8 (Unauthorized)
  404: 25 (Not Found)
  405: 15 (Method Not Allowed)

ğŸ‰ Mapeamento concluÃ­do!
ğŸŒ Abra o relatÃ³rio HTML para visualizaÃ§Ã£o detalhada
```

## ğŸ”§ Funcionalidades AvanÃ§adas

### DetecÃ§Ã£o de Rotas DinÃ¢micas

O script automaticamente detecta e testa rotas com parÃ¢metros:

- `[id]` â†’ `:id` â†’ testado com valor `1`
- `[userId]` â†’ `:userId` â†’ testado com valor `1`
- `[...slug]` â†’ `/*` â†’ testado com valor `test`

### DetecÃ§Ã£o de AutenticaÃ§Ã£o

O script analisa o cÃ³digo das rotas para detectar se requerem autenticaÃ§Ã£o:

- Busca por palavras-chave: `auth`, `token`, `jwt`, `session`, `Authorization`
- Automaticamente inclui header `Authorization: Bearer <token>` quando necessÃ¡rio

### AnÃ¡lise de Performance

- Mede tempo de resposta de cada endpoint
- Calcula tempo mÃ©dio por rota
- Identifica endpoints lentos

### Tratamento de Erros

- Retry automÃ¡tico para falhas de rede
- Timeout configurÃ¡vel
- Tratamento gracioso de erros de parsing JSON

## ğŸ› Troubleshooting

### Erro: "DiretÃ³rio de API nÃ£o encontrado"

Certifique-se de executar o script a partir da raiz do projeto:

```bash
cd /caminho/para/Portal
node scripts/api-route-mapper.js
```

### Erro: "Falha no login"

Verifique:
1. Se o servidor estÃ¡ rodando
2. Se as credenciais estÃ£o corretas
3. Se a URL base estÃ¡ correta

### Erro: "Request timeout"

Aumente o timeout no arquivo de configuraÃ§Ã£o:

```javascript
const CONFIG = {
  timeout: 30000, // 30 segundos
};
```

### Muitas falhas 404

Isso Ã© normal para rotas dinÃ¢micas que requerem IDs especÃ­ficos. O script usa valores de teste genÃ©ricos.

## ğŸ“ˆ Interpretando os Resultados

### Status HTTP Comuns

- **200 OK**: Rota funcionando perfeitamente
- **201 Created**: Rota de criaÃ§Ã£o funcionando
- **400 Bad Request**: Dados de teste invÃ¡lidos (normal)
- **401 Unauthorized**: Falha na autenticaÃ§Ã£o
- **403 Forbidden**: Sem permissÃ£o para acessar
- **404 Not Found**: Rota ou recurso nÃ£o encontrado
- **405 Method Not Allowed**: MÃ©todo HTTP nÃ£o suportado

### Taxa de Sucesso

- **90-100%**: Excelente
- **80-89%**: Bom (algumas rotas podem ter validaÃ§Ãµes especÃ­ficas)
- **70-79%**: AceitÃ¡vel (verificar rotas com falha)
- **<70%**: Problemas significativos

## ğŸ¤ Contribuindo

Para melhorar o script:

1. Fork o projeto
2. Crie uma branch para sua feature
3. FaÃ§a commit das mudanÃ§as
4. Abra um Pull Request

## ğŸ“ Changelog

### v1.0.0 (2025-01-07)
- VersÃ£o inicial
- Descoberta automÃ¡tica de rotas
- AutenticaÃ§Ã£o automÃ¡tica
- RelatÃ³rios JSON e HTML
- Suporte a rotas dinÃ¢micas
- DetecÃ§Ã£o de autenticaÃ§Ã£o

## ğŸ“„ LicenÃ§a

MIT License - veja o arquivo LICENSE para detalhes.

## ğŸ‘¨â€ğŸ’» Autor

**Kilo Code** - Engenheiro de Software Especializado

---

ğŸ’¡ **Dica**: Execute o script regularmente durante o desenvolvimento para detectar problemas nas APIs rapidamente!